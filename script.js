<entire JS code from canvas goes here>